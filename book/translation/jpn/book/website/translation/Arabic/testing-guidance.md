<a name="General_guidance_and_good_practice_for_testing"></a>

# الإرشادات العامة والممارسات الجيدة للاختبار

هناك عدة {ref}`أنواع مختلفة`<rr-testing-types-of-testing> • الاختبار الذي يكون لكل واحد منه أفضل الممارسات الخاصة به. ومع ذلك، هناك بعض الإرشادات العامة التي تنطبق على جميع هذه البلدان، والتي سيتم إيجازها هنا.

(ص - اختبار - كتابة)=
## كتابة الاختبارات - أي اختبارات!

بدء عملية اختبارات الكتابة يمكن أن يكون مغلقا، خاصة إذا كان لديك قاعدة رموز كبيرة. وعلاوة على ذلك، وكما ذكرنا فإن هناك أنواعا عديدة من الاختبارات، ويمكن أن يبدو تنفيذها جميعا كجبل مستحيل الصعود. ولهذا السبب فإن أهم توجيه في هذا الفصل هو كما يلي: **كتابة بعض الاختبارات**. اختبار شيء صغير في التعليمات البرمجية بطول آلاف الأسطر هو أفضل بلا حدود من اختبار لا شيء في التعليمات البرمجية التي تطول آلاف الأسطر. قد لا تكون قادراً على فعل كل شيء، ولكن القيام *بشيء* قيم.

إجراء تحسينات حيث يمكنك ذلك، وبذل قصارى جهدك لتضمين الاختبارات مع التعليمات البرمجية الجديدة التي تكتبها حتى لو لم يكن من الممكن كتابة الاختبارات لجميع التعليمات البرمجية المكتوبة بالفعل.

## تشغيل الاختبارات

ثاني أهم نصيحة في هذا الفصل: قم بتشغيل الاختبارات. إن وجود مجموعة اختبار جميلة مثالية لا يستخدم إذا كنت نادراً ما تشغلها. إن ترك فجوات طويلة بين عمليات الاختبار يزيد من صعوبة تتبع الخطأ الذي وقع عندما يفشل الاختبار، لأنه الكثير من التعليمات البرمجية ستكون قد تغيرت. وأيضا، إذا كان قد مضى أسابيع أو أشهر منذ إجراء الاختبارات وفشلت، ومن الصعب أو المستحيل معرفة ما هي النتائج التي تحققت في الوقت المتوسط التي لا تزال صالحة. والتي يجب أن تُلقى بعيداً لأنه كان يمكن أن تكون قد تأثرت بالخطأ.

من الأفضل أتمتة اختبارك قدر الإمكان. وإذا كان كل اختبار يحتاج إلى إجراء فردي، فمن المرجح أن تُهمل العملية المضنية المملة. يمكن القيام بذلك باستخدام إطار اختبار ([نوقش لاحقاً](#use-a-testing-framework)). [Jenkins](https://jenkins.io) أداة جيدة أخرى لهذا الغرض. قم بضبط اختباراتك بشكل مثالي لتعمل على فترات منتظمة، ربما كل ليلة.

النظر في إعداد التكامل المستمر (مناقشة في الفصل الخاص بالتكامل المستمر) في مشروعك. سيؤدي هذا تلقائياً إلى تشغيل الاختبارات الخاصة بك في كل مرة تقوم فيها بتغيير التعليمات البرمجية الخاصة بك، اعتمادًا على برنامج الدمج المستمر الذي تستخدمه، سيتم إعلامك إذا فشل أي من الاختبارات.

## فكر في الوقت الذي تستغرقه الاختبارات لتشغيلها

بعض الاختبارات، مثل {ref}`محرر الاختبار` فقط اختبار قطعة صغيرة من التعليمات البرمجية وبالتالي عادة ما تكون سريعة جدا. غير أن أنواعاً أخرى من الاختبارات، مثل {ref}`نظام اختبار rr-test-system` التي تختبر الكود بأكمله من النهاية إلى النهاية، قد يستغرق تشغيله وقتاً طويلاً اعتماداً على التعليمات البرمجية. وعلى هذا النحو، قد يكون من المعوق إجراء مجموعة الاختبار بأكملها بعد كل جزء صغير من العمل. وفي هذه الحالة، من الأفضل إجراء اختبارات أقل وزنا مثل اختبارات الوحدة بشكل متكرر، واختبارات أطول أجلا مرة واحدة في اليوم بين عشية وضحاها. من الجيد أيضاً قياس عدد كل نوع من الاختبارات التي لديك فيما يتعلق بمدة تشغيلها. يجب أن يكون لديك الكثير من اختبارات الوحدة (أو أنواع أخرى من الاختبارات السريعة) ولكن أقل بكثير من الاختبارات التي تستغرق وقتا طويلا للتشغيل.

## توثيق الاختبارات وكيفية تشغيلها

ومن المهم تقديم وثائق تصف كيفية إجراء الاختبارات، وكلاهما لنفسك في حالة عودتك إلى مشروع في المستقبل، ولأي شخص آخر يرغب في البناء على عملك أو استنساخه. وينبغي أن تشمل هذه الوثائق أيضاً مواضيع مثل

- أي موارد، مثل ملفات اختبار مجموعة البيانات المطلوبة
- أي تعديلات/إعدادات تحتاج لتشغيل الاختبارات
- ما هو البرنامج (مثل [أطر الاختبار](#use-a-testing-framework)) الذي يحتاج إلى تثبيته

من الناحية المثالية، يمكنك توفير البرامج النصية لإعداد وتكوين أي موارد مطلوبة.

## اختبار الحالات الواقعية

اجعل الحالات التي تختبرها واقعية قدر الإمكان. إذا على سبيل المثال، لديك بيانات غامضة لتشغيل الاختبارات عليك التأكد من أن البيانات مماثلة قدر الإمكان للبيانات الفعلية. إذا كانت بياناتك الفعلية فوضوية مع الكثير من القيم الفارغة، لذا يجب أن تكون مجموعة بيانات الاختبار الخاصة بك.

## استخدام إطار اختبار

وهناك أدوات متاحة لتيسير الكتابة وإجراء الاختبارات، وتعرف هذه الأدوات باسم أطر الاختبار. ابحث عن واحدة تحبها، اتعلم عن الميزات التي تعرضها، و استخدمها. وتشمل أطر الاختبار المشتركة (واللغات التي تنطبق عليها) ما يلي:

- لا تشرح اللغة
  - تم اختباره، اختبر الجهاز التنفيذي ، سكريبت باش ، وأكثر من ذلك. رائع لتحديث التعليمات البرمجية القديمة
- + (C)
  - التقاط
  - اختبار كبست
  - التعزيز::اختبار
  - جوجل اختبار
- ج
  - جميع أطر C++
  - تحقق
  - CUnit
```{note}
في حين أن C++ و C الحديثين لا يزالان متوافقين في الأغلب، فإنهما لا يستعملان الإطار التجريبي بشكل متبادل، قد لا ينجحا دائما.
```
- Python
  - الاختبار (مستحسن)
  - unittest يأتي مع مكتبة بايثون القياسية
- اختبارات الوحدة R
  - اختبار
  - tinytest
  - SvUnit (يعمل مع SciViews GUI)
- اختبارات الوحدة الفورية:
  - وحدة
  - pfUnit (يعمل مع MPI)

## الهدف هو الحصول على تغطية رمزية جيدة

تغطية الكود هي مقياس لمقدار الكود الخاص بك "المشمول" بالتجارب. بمزيد من الدقة فإنه مقياس لكمية التعليمات البرمجية الخاصة بك التي يتم تشغيلها عند إجراء الاختبارات. لذا على سبيل المثال، إذا كان لديك بيان `إذا` ولكن فقط اختبر الأشياء التي يقوم فيها هذا البيان بتقييم "False" فلن يتم تشغيل أي من التعليمات البرمجية في الكتلة إذا تم تشغيل الكتلة. ونتيجة لذلك، ستكون تغطية التعليمات البرمجية الخاصة بك < 100%. التغطية البرمجية لا تشمل الوثائق مثل التعليقات، لذا فإن إضافة المزيد من الوثائق لا تؤثر على النسب المئوية.

وكما نوقش فإن أي اختبارات تمثل تحسنا عن عدم وجود اختبارات. ومع ذلك، من الجيد أن تطمح على الأقل إلى أن تكون تغطية التعليمات البرمجية الخاصة بك عالية قدر الإمكان.

ومعظم لغات البرمجة لديها أدوات إما مدمجة فيها، أو يمكن استيرادها، أو كجزء من أطر الاختبار، التي تقيس تلقائياً تغطية الرموز. هناك [بوت صغير لطيف](https://codecov.io/) لقياس تغطية التعليمات البرمجية المتاحة أيضا.

**Pitfall: وهم التغطية الجيدة.** في بعض الحالات، يمكن بل ربما ينبغي اختبار نفس الكود بطرق متعددة. على سبيل المثال، يمكن للتغطية أن تزيد بسرعة على التعليمات البرمجية التي تطبق اختبارات "التحقق من الصحة العامة" على إخراجها (انظر أيضا {ref}<rr-testing-challenges-difficult-quatify>)، ولكن هذا لا يستبعد احتمال أن تنتج التعليمات البرمجية الإجابة الصحيحة بشكل عام لأسباب خاطئة. وبوجه عام، فإن أفضل الاختبارات هي تلك التي تعزل الأجزاء الأصغر حجما بدلا من الأجزاء الأكبر من الشفرة المتسقة، وهكذا اختر خطوات فردية من المنطق. حاول أن تسترشد بالتفكير في الأشياء المحتملة التي قد تحدث لجزء معين من التعليمات البرمجية في تنفيذ الكل، واختبر هذه الحالات الفردية. في كثير من الأحيان، سيؤدي هذا إلى اختبار نفس الكود عدة مرات - هذا شيء جيد!

## استخدام اختبارات مضاعفة/مستودعات/سكاكين حيثما كان ذلك مناسباً

وفي حالة فشل الاختبار، ينبغي أن يوضع بحيث يكون من السهل تتبع مصدر الفشل قدر الإمكان. هذا يصبح مشكلة إذا كان جزء من التعليمات البرمجية تريد اختبارها يعتمد بشكل لا مفر منه على أشياء أخرى. على سبيل المثال إذا فشل اختبار لجزء من التعليمات البرمجية التي تتفاعل مع الويب، قد يكون ذلك لأن الكود يحتوي على خطأ *أو* بسبب وجود مشكلة في الاتصال بالإنترنت. وبالمثل، إذا فشل اختبار لجزء من التعليمات البرمجية التي تستخدم كائنا ما يمكن أن يكون بسبب وجود خلل في التعليمات البرمجية التي يجري اختبارها، أو مشكلة مع الجسم (الذي ينبغي اختباره بواسطة اختبارات منفصلة خاصة به). وينبغي إزالة هذه التبعيات من الاختبارات، إن أمكن. ويمكن القيام بذلك باستخدام بدائل الاختبار (مضاعفات الاختبار) بدلا من التبعيات الحقيقية. ويمكن تصنيف المزدوج الاختباري على النحو التالي:

- يتم تمرير جسم غريب ولكن لا يستخدم أبدا، مما يعني أن أساليبه لا تسمى مطلقا. ويمكن استخدام مثل هذا الجسم، على سبيل المثال، لملء قائمة البارامترات للطريقة.
- أشياء وهمية لها تطبيقات عمل، ولكن عادة ما تكون مبسطة. فهم، على سبيل المثال، يستخدمون قاعدة بيانات في الذاكرة وليس قاعدة بيانات حقيقية.
- المواد هي تنفيذ جزئي لواجهة أو فئة لغرض استخدام مثيل من هذه الأشياء أثناء الاختبار. عادة لا تستجيب الأستاذ لأي شيء خارج ما تم برمجته للاختبار. من الممكن أن تسجل الاستعلامات أيضاً معلومات عن المكالمات.
- الكائن الصوري هو التنفيذ الوهمي لواجهة أو فئة تحدد فيها ناتج مكالمات طريقة معينة. يتم تكوين الكائنات الوهمية لتنفيذ سلوك معين أثناء الاختبار. وعادة ما تسجل التفاعل مع النظام ويمكن للاختبارات أن تثبت صحة ذلك.

يمكن نقل مضاعفات الاختبار إلى الكائنات الأخرى التي يتم اختبارها.

يمكنك إنشاء كائنات وهمية يدوياً (عبر الكود) أو استخدام إطار صوري لمحاكاة هذه الصفوف الدراسية. تسمح لك الأطر الوهمية بإنشاء كائنات وهمية في وقت التشغيل وتحديد سلوكها. المثال الكلاسيكي لكائن صوري هو موفر البيانات. ويستخدم في إنتاج برنامج تنفيذي للاتصال بالمصدر الحقيقي للبيانات. ولكن لاختبار جسم صوري يحاكي مصدر البيانات ويكفل أن تكون ظروف الاختبار هي نفسها دائما.
