(rr-rdm-电子表格)=
# 电子表格中的数据组织

Spreadsheetsets, such as Microsoft Excel文件, google sheets, and their Open Source alternative [(例如，) LibreOffice](https://www.libreoffice.org), , 通常用于收集、储存、操作、分析和分享研究数据。 预览表是方便和易用的工具，用于将信息组织成便于撰写和易读的人类表格。 然而，人们应当谨慎地使用这些表格，因为使用不适当的电子表格是数据分析工作流程中出现错误的主要原因。 有一个 [恐怖故事](http://www.eusprig.org/horror-stories.htm) 集，它说明由于电子表格的意外行为或错误的 编辑过程，使用电子表格如何能够破坏基于分析的研究。 有些错误并不是电子表格所独有的，但是很多错误，例如 [此](https://doi.org/10.1186/s13059-016-1044-7) 和 [是](https://doi.org/10.1186/1471-2105-5-80)。

幸运的是，下列建议可以避免大多数问题：
- 以纯文本格式使用电子表格 (.csv 或 .tsv)，
- 创建tidy 电子表格，
- 使电子表格(彼此一致)并实施数据输入规则，
- 避免操纵和分析电子表格软件中的数据(这包括复制粘贴)。

只有在数据集是以可用于计算机和研究人员的特定格式收集和编排时，预报表才是一种强有力的工具。

(rr-rdm-电子表格-nondata)=
## 1. 避免非数据内容

电子表格用于以表格形式组织数据。 主题、对象和它们之间的关系分别变成一行、单元格和列。 例如，主题： `expert`, relationship: `是在日期`, 和对象： `2020-06-06` 给每次实验提供一行 用于 `实验日期`的一列，单元格中的值 `2020-06-06`。 不幸的是，电子表格程序允许您添加其他类型的内容，例如颜色到特定的单元格。 虽然它可能在某个时候对研究人员有所帮助， 人们需要记住，这种类型的 **单元格修改不应被视为数据**， 主要是因为它们不能导出到其他软件。

作为一条简单的规则，可以用纯文本格式、逗号分隔值(CSV)或制表符分隔值(TSV)导出的东西可以被视为数据。 在利用这些方案获取研究数据时，应避免其他功能。 其中包括：
- 更改字体、颜色或边框
- 使用函数，
- 合并单元格(这个单元格问题特别严重)
- 使用特定单元格格式(特别是日期，见下文)。

作为您的电子表格与可复制研究兼容性的测试，将您的数据从电子表格导出到CSV格式并重新打开它。 如果你仍然可以获得你存储在你的工作表中的所有信息，那么你的数据是很好的。

```
提示：如果您想使用颜色来帮助您的文档快速高亮显示。 创建一个新列来显示哪个单元格被高亮(它成为您数据的一部分)。
除了视觉反馈外，您现在也可以使用此信息过滤或排序您的数据并快速获取高亮的单元格。

```
(rr-rdm-电子表格格式)=
## 2. Streadsheets Tidy 格式

If the spreadsheet is poorly organised, then it may be [difficult for collaborators](https://luisdva.github.io/pls-don't-do-this/) to easily {ref}`read-in and re-use <rr-rdm-fair>` your data for further analysis.

事实上，数据科学家的大部分工作是将数据变成计算机可以阅读的形式。 然而，仍然存在着这种情况。 当信息分成几个电子表格和在获得数据之前没有具体的数据转换计划时，这种情况耗费了大量时间。

简化数据使用的规则非常简单，这些规则涉及 [**tidy data**](https://en.wikipedia.org/w/index.php?title=Tidy_data&oldid=962241815) tidy数据格式允许在电子表格软件中易于过滤和排序数据。

简体：

- 一列 = 一个变量(至少，这意味着两个标题不能完全相同)
- 一行 = 一个示例
- 一个单元格 = 一个信息
- **第一行是标题**
- 标题名称不能包含特殊字符(包括空格)或以数字开头。

```{figure} ../../figures/tidy-1.png
---
name: tidy-1
alt: 图像描述了tidy 数据。 一个列代表一个变量，一个列代表一个样本，一个单元代表一个信息。
---
是整洁数据的图示.
```

三条规则生成数据集提示：
1. 每个变量必须有自己的列。
2. 每项观察必须有自己的一行。
3. 每个值必须有自己的单元格。

有可用的数据验证工具，例如https://goodtables.io，您可以自动检查您的电子表格是否是潮湿的。

(rr-rdm-电子表格的一致性)=
## 3. 一致值

当您使用多个电子表格或在数据收集过程中与团队合作时， 必须确保以同样的术语输入同样的信息， 而且同一术语总是传达同样的信息。 In the example of iris data, if some people use different terms to record information for a specific column - such as naming the column `species` instead of `Species` or using `iris setosa`, `set.` or `i.setosa` instead of `setosa` - the creation of a reproducible workflow will be more difficult, and errors may even be overlooked.  
Discrepancies often lead to errors, especially when the same terms could mean different things depending on who is entering the data. For example, indicating date as `02-03` will mean February the 3<sup>rd</sup> in the USA, but March the 2<sup>nd</sup> in Europe.

一个由 `数据字典` 或 `分类法` 用于README 文件的公认术语和文档是很好的做法。 根据您使用的软件，您可以在特定列中限制接受的值。 如果有这种分类法或生物学，使用它可以使您(和其他人)与其他数据集一起使用这些数据。 例如， 您可以使用通用的 `男性，` 和 `女方` 术语来描述动物的性别(无首都) 在不使用缩略语的情况下，有许多术语使用这些术语。 此外，您可能想要使用一些额外的工具来验证电子表格，然后将其纳入分析中。

您还应该有关于缺失数据点的明确规则。 使用 `NA`, `NULL`, 或空单元格不是微不足道的，可能有不同的含义(不可能的数据点、没有记录或丢失的数据点)。 想象一下，研究人员想记录一下花费的时间，然后才能看到一块铁花上的粉碎土地， 在10分钟的试验中，没有看到喷雾器。 假设研究人员报告 `600` (实验持续时间以秒为单位)。 在这种情况下，就无法区分没有看到投票人的假想， 和一次在实验结束时看到一个抛光器(你可能会忘记这条规则并将 `600` 视为一个正常值)。

如果 `NA` 被报告，人们可能会将此值解释为一个不存在的数据点(实验尚未进行)。 优雅的解决方案是第二列，说明在试验期间是否看到过闪光器。 其中 `TRUE`, `FALSE` 和 `NA` 值已被接受。

最后，您还应该知道您的电子表格程序的默认行为。 不同程序和不同版本的同一程序可能不同。 例如，在Excel的法文或德文版本中，通常用逗号标明小数。 在英文版本中使用一个点，因为逗号没有意义(`9, ) 00` 将被翻译成 `9000` 或 `9` 取决于您使用的版本)。

(rr-rdm-电子表格-操纵)=
## 4. 数据操纵和分析

***不要操纵或分析电子表格程序中的数据。***

特别是，如果过程很少使用，只有从一个电子表格粘贴到另一个电子表格。 现在，在分析软件中阅读和合并各种不同的电子表格是毫无意义的。 还有额外的优势，即如果信头不适合，软件将返回错误消息。

(rr-rdm-电子表格-提示)=
## 其他提示

(rr-rdm-电子表格-提示-时间)=
### 处理时间信息

日期应该以 `yyy-mm-dd`写， Excel和其他软件倾向于将此数据转换成自己的日期格式(即使是在从CSV文件导入数据期间)。 处理这个问题的唯一100%安全的方法是多年来制造不同的列. 请将本函及其附件作为大会第五十九届会议的文件分发为荷。 Time entered with `hh:mm:ss` normally works.

(rr-rdm-电子表格-tips-several)=
### 使用几张木板

我们常常使用不同但相关的数据表。 它确实是一种方便的工具，特别是当人们想要与同事们分享完整的数据集时。  
另一方面，CSV 文件一次只保存一个工作表。 虽然大多数数据分析软件有几种方法导入 `xlsx` 文件， 实用的解决方案是使用 `xlsx` 格式，同时确保每个工作表都有CSV 格式的信息。 一个更好的解决办法，尤其是长期储存的解决办法，是将所有工作单单独保存到一个CSV文件并将它们放在一起。 这个解决方案还允许包含可能采用不同格式的额外文档(例如)。 解释标题和所选单位含义的文本文件)。

(rr-rdm-电子表格-提示设计)=
### 电子表格设计

数据往往以书面形式以手工方式收集。 为了效率最高并避免错误，最好以数字化的格式收集数据。 也就是说，应当设计可用于收集数据的计算机读取电子表格。 这提出了一些设计问题，特别是对于某项实验所独有的信息而言（一份纸），但可能会在不同的实验之间发生改变（例如）。 房间的实验或温度)。 您确实想要该信息列在一个列中，但您只想在数据采集过程中输入一次(尤其是在纸面版本上)。 一种解决办法是将这些列移动到电子表格上的第二个(非打印的)页面，并调整标题和页脚以便在纸面版本中输入信息。 我们需要确保在数字化过程中将信息输入列中。

您输入信息的方式(即： 您设计头部和单元格内容的方式可能因您想要执行的分析而不同。 人们仍然应当总是尽量做到通用和客观，并考虑人们可能想要进行的任何其他分析。


例如， 让我们猜想你有兴趣描述三个铁种中其海豹长度超过6毫米的花的百分比是否不同。 您可能会倾向于记录真实或假列 `is-sepal-longer-than 6cm`, 但这将限制您可以进行的分析。 更好的解决方案是记录sepal的长度(毫米)，并在以后自动创建分类。

如果您正在使用 R，您将会绘制您想要做的事：
```
iris %>% ## 铁数据集包含在 R base
  dplyr::mutate, ("is-sepal-longer-than 6cm" = ifels(Sepal)。 ength >6, TRUE, FALSE) %>## 创建新列
  gggpl2:::ggplot (aes (x=`is-sepal-longer-than-6cm` , fill= species)) + gggplot2::geom_bar() ## 此绘图数据
```

头部名称应谨慎选择，如果不清楚是什么意思，使用什么单位。 您可能想要在外部文档中添加一些解释。 您还可以将一个样本电子表格分享给同事，以获得关于您的工作表如何可以理解的反馈。

另一种备选办法是在页首前面加上一些解释。 通过将可读的信息保留在文件的顶部可以更好地理解始于标题行的数据。 这种信息也有助于分析这种数据，确保脚本无视解释线，只能在分析时加以考虑。 然而，不应需要额外解释一个完整的细列和细列的文件。

至于头部的名字，头部的大小对计算机来说不是问题。 然而，就人类可读性而言，最好保持短篇幅（最多32个字符）。

您不必考虑分析的列顺序，因为它对数据分析软件没有重要意义。 因此，您可以完全优化数据收集步骤的参数。

(rr-rdm-电子表格-tips-version)=
### 标准和版本

一个良好的电子表格设计具有启发性和直观性的标题，它便利了数据收集和分析。 建立这种电子表格设计是困难的，因为这需要时间、多次迭代和共识。 因此，在设计您自己之前寻找标准电子表格并在创建后公开分享您的设计是有益的。 人们还应使用电子表格的版本历史（随着其演变而来）， 和分析脚本应提及电子表格的版本号。 电子表格文件、其版本历史以及它与之相关联的内联网，对未来的用户可能是有用的。

(rr-rdm-电子表格-提示-team)=
### 在团队中工作：总结

如果您正在与一个团队合作收集数据，请确定：
- 每个人都使用相同的软件(和软件版本)输入数据。
- 每个人都使用相同版本的电子表格模板。
- 每个人都了解每一栏所代表的是什么，以及应该使用的单位。
- 每一列都有一个定义的标准，说明如何输入其中的数据或可以使用的术语分类。
- 一个人负责在数据收集期间回答假定的问题。
- 每张电子表格在输入分析工作流程之前都要验证，并尽快验证。


(rr-rdm-电子表格摘要)=
## Summary

虽然电子表格可以是一种方便用户的收集和分享数据的方法，但如果使用不当，也可能成为错误的来源。 当旨在开发可用于分析的可复制工作流程时，人们应设计计算机和人的可读性的电子表格。 而且，即使在开始收集数据之前，他们也应考虑如何使他们的数据分析更加容易。 尤其是电子表格中的数据操纵和分析最好避免，因为它导致不可再生产的工作流。 使用版本控制和使数据只读是可以预防事故的另外两种数据管理做法。

使用README [{term}`def<README>`] 文件和其他结构选项来解释命名协议。 它将向其他人说明文件和文件头名称的含义，以及在设计分析工作流程时应考虑的标准。 如果你在一个团队中工作，你应该特别注意公约并确保每个人都遵守这些公约。

了解更多关于电子表格中数据组织的信息， 您可能会查看 [社会科学家](https://datacarpentry.org/spreadsheets-socialsci/) 和 [生态学家](https://datacarpentry.org/spreadsheet-ecology-lesson/) 的数据木工课程。
