(rr-reviewing-workflow)=
# 典型工作流

*本章特别提到Github*

```{figure} ../../figures/readable-code.jpg
---
高度：500px
名称：可读码
Alt：此图像突出了代码可读性的重要性。
---
_Ting Way_ 项目示意图由 Storeria 标明。 在 CC-BY 4.0 许可下使用。 DOI：[10.5281/zenodo.3332807](https://doi.org/10.5281/zenodo.3332807)。
```

## 正式与非正式审查

为了使正式的审查进程有效运作，该项目必须使用很好的 {ref}`版本控制<rr-vcs>`。 然而，值得指出的是， **所有代码审查都是非常有价值的**, 包括非正式或临时办法。 事实上，即使在高度正规化的审查管道中，这种非正式的“肩负”同级审评也可以构成一个关键的初步组成部分。 一旦正式阶段开始，就会节省大量的压力并争辩。

本节侧重于正式审核过程背后的典型工作流，通常在 [Github](https://github.com/) 中实现。 其他编码环境，例如 [BitBucket](https://bitbucket.org/) or [GitLab](https://about.gitlab.com/) 可能有概念上相似的机制，但在这里没有解释。

## 准备代码

在请求审查之前，请确保您已经达到了您正在贡献的项目的所有明显质量基准。 这意味着请确保您已经检查过审核列表(见代码&lt;rr-checklist-for-code-review&gt;</code> 的 {ref}`清单)。</p>

<p spaces-before="0">审核者应检查这些内容(见编程器的 {ref}<code>清单<rr-checklist-for-code-review>`)， 但这些方面的缺陷应该是偶尔的监督，而不是系统性的。

## 提议更改

在 GitHub 系统中，评论直接从 [拉取请求页](https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request) 开始并经常访问。 审查步骤发生在编程员认为他们的贡献已经完成并且该贡献已并入项目的中继代码的各点之间。 所以它与一个单一的拉请求密切相关。

Within the Github environment, projects can be configured to *require* a review before a given pull request can be merged. 即使这个选项尚未被选中，仍然可以(甚至最佳做法)手动请求对一个待处理的合并请求进行审查。

## 创建并讨论评论

此时此刻，审查进程可以开始。 在 Github, 审核者可以提供一般性评论和逐行评论，请参阅 [GitHub 代码评论](https://github.com/features/code-review)。 每个评论都成为自己的评论线索，以便根据需要对每个问题进行反复讨论。 这种互动应当能够就每一项评论达成共识。

评论完成后，您可以讨论任何必要的评论。 然后您做出更改，并根据适当的评论记录所做的更改。 另外，您检查审核员是否知道您认为您已经完全解决了审核问题。

一旦您认为更改已经完成，审核员将检查他们是否确实解决了所有的初始评论。 在需要时，如果审查人员对某些问题有不同意见，以便达成协商一致意见，他们将建设性地与你接触。 在大多数情况下，如果不能达成共识，审查员就有最后发言权。

一旦对该代码进行了审查后的更改， 根据需要对评论进行最后更新，以完成已经做的工作及其推理的历史。

## 通过 GitHub 通信结果

在 Github, 评论应该添加到 `文件更改了` 部分。 这样他们可以被附加到特定的代码行中，见 [GitHub 审查脉冲请求中的更改](https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/reviewing-changes-in-pull-requests)。 以这种方式发表许多小的评论，而不是用其中的一切作一整套大的文字，以便将不同的问题分开处理。 在相关情况下，请参阅现有问题和文件。

如果您正在审查现有代码而不是更改，那么使用拉取请求仍然是方便的。 如果你发现一个问题有一个明显的解决方案，你可以以通常的方式提交一个带有补丁的拉请求。

如果您没有修复，您可以在相关行中添加空注释。 并从中创建一个拉取请求作为补丁。 然后在拉取请求的 `文件中显示相关线索会改变` 概述，您可以在这里添加您的评论。 在这种情况下，合并请求可能永远不会被合并(但评论处理了其他方式) 或额外的评论被还原，代之以商定的解决办法。

在所有情况下，提交许多小的合并请求，而不是一个大的合并请求，因为GitHub对代码审查的支持相当有限。 将太多的问题放入一个单一的拉请求很快就会变得不可行了。

## 合并更改

一旦审查进程完成，审查员将批准修改，并且可以进行合并。 各个项目一般都有规则和/或准则，说明代码或审核者是否实际按下合并按钮，所以检查。 在许多情况下，项目工作流程使得审评员完成一项审查并签字成为进行合并的正式先决条件。 为了避免产生疑问，甚至对小型或非正式项目采用这一原则也许是明智的。
