(rr-rdm-スプレッドシート)=
# スプレッドシート内のデータ組織

Microsoft Excel ファイル、google sheets、Open Source Alternative [(例えば) LibreOffice](https://www.libreoffice.org)などのスプレッドシート。 研究データの収集、保存、操作、分析、共有に一般的に使用されます。 スプレッドシートは、便利で使いやすいツールで、情報を簡単に書きやすく、人のための読みやすいフォームに整理します。 ただし、不適切なスプレッドシートの使用は、データ分析ワークフローの間違いの主な原因であるため、注意を払って使用する必要があります。 There is a collection of [horror-stories](http://www.eusprig.org/horror-stories.htm) that tells how the use of spreadsheets can ruin analysis-based studies due to unexpected behaviour of the spreadsheet or error-prone editing processes. これらの不具合のいくつかは、スプレッドシートに固有のものではありませんが、 [この](https://doi.org/10.1186/s13059-016-1044-7) や [この](https://doi.org/10.1186/1471-2105-5-80)のような多くはそうです。

幸いなことに、以下の推奨事項ではほとんどの問題を回避することができます。
- テキストのみの書式でスプレッドシートを使用する (.csv または .tsv)
- 整頓された表計算ドキュメントを作成
- スプレッドシートを一貫性のあるものにし、データエントリのルールを実装します。
- スプレッドシートソフトウェアでのデータの操作や分析は避けてください (これはコピーペーストを含みます)。

スプレッドシートは、データセットが収集され、コンピュータと研究者の両方に使用可能な特定の形式で整理された場合にのみ、強力なツールです。

(rr-rdm-spreadsheets-nondata)=
## 1. データ以外のコンテンツを回避する

スプレッドシートは表形式でデータを整理するために使用されます。 件名、オブジェクト、およびそれらの間の関係は、それぞれ行、セル、および列に変換されます。 For example, the subject: `experiment`, relationship: `was performed on the date`, and the object: `2020-06-06` gives one row for each experiment, one column for `date of experiment`, and the value `2020-06-06` in the cell. 残念ながら、スプレッドシートプログラムでは、特定のセルに色のような他の種類のコンテンツを追加できます。 それはある時点で研究者を助けるかもしれませんが。 この種の **セル修正をデータとみなすべきではないことを覚えておく必要があります**他のソフトウェアにはエクスポートできないからです

単純なルールとして、テキストのみフォーマットでエクスポートできるもの、カンマ区切り値 (CSV)、またはタブ区切り値 (TSV) をデータとみなすことができます。 これらのプログラムを研究データに使用する場合は、その他の機能は避けるべきです。 これには以下が含まれます：
- フォント、色、枠の変更
- 関数を使って
- セルの結合（これは特に問題です）
- 特定のセル形式 (特に日付) を使用します。

再現性のある研究とスプレッドシートの互換性のテストとして、スプレッドシートからCSV形式にデータをエクスポートして再度開きます。 まだシートに保存されているすべての情報を取得できる場合は、データは問題ありません。

```
ヒント: ドキュメント内の急速なハイライト表示を支援するために色を使用する場合。 ハイライトされるセルを示す新しい列を作成します (データの一部になります)。
視覚的なフィードバックに加えて、この情報を使用してデータをフィルタリングまたはソートし、ハイライトされたセルをすばやく取得することもできます。

```
(rr-rdm-spreadsheets-format)=
## 2. 表計算ドキュメントのタイディフォーマット

If the spreadsheet is poorly organised, then it may be [difficult for collaborators](https://luisdva.github.io/pls-don't-do-this/) to easily {ref}`read-in and re-use <rr-rdm-fair>` your data for further analysis.

データサイエンティストの大部分はデータをコンピュータが読み取れる形に変換することです ただし、 データが複数のスプレッドシートに分割されている場合と、データが取得される前に具体的なデータ変換計画がない場合は、これは非常に時間がかかります。

[**整頓されたデータ**](https://en.wikipedia.org/w/index.php?title=Tidy_data&oldid=962241815) の概念に入るデータの使用を容易にする非常に簡単なルールがあります。 整然としたデータフォーマットにより、表計算ソフトで簡単にデータのフィルタリングや並べ替えができます。

要するに:

- 1 列 = 1 変数 (これ以上、これは 2 つのヘッダー名が同一になることができないことを意味します)
- 1 行 = 1 サンプル
- 1つのセル = 1つの情報
- **最初の行はヘッダーです**
- ヘッダー名に特殊文字（スペースを含む）または数字で始まる文字を含めてはいけません

```{figure} ../../figures/tidy-1.png
---
name: tidy-1
alt: 整然としたデータを表しています。 1つの列は変数を表し、1つの行はサンプルを表し、1つのセルは1つの情報を表します。
---
整然としたデータの図。
```

3 つのルールは、データセットを整理します:
1. 各変数はそれぞれの列を持たなければなりません。
2. 各観察記録にはそれぞれの行が必要です。
3. 各値はそれぞれのセルを持つ必要があります。

https://goodtables.io のようなデータ検証ツールがあり、スプレッドシートが整理されているかどうかを自動的に確認できます。

(rr-rdm-spreadsheets-consistent)=
## 3. 一貫した値

データ収集中に複数の表計算ドキュメントやチームと作業する場合 同じ用語で同じ情報を入力することが重要です 同じ用語は常に同じ情報を伝えています In the example of iris data, if some people use different terms to record information for a specific column - such as naming the column `species` instead of `Species` or using `iris setosa`, `set.` or `i.setosa` instead of `setosa` - the creation of a reproducible workflow will be more difficult, and errors may even be overlooked.  
Discrepancies often lead to errors, especially when the same terms could mean different things depending on who is entering the data. For example, indicating date as `02-03` will mean February the 3<sup>rd</sup> in the USA, but March the 2<sup>nd</sup> in Europe.

`データ辞書` または受け入れられた用語の `タクソノミー` を実装し、READMEファイルで使用される慣習を文書化することをお勧めします。 使用するソフトウェアによっては、特定の列の許容値を制限することができます。 このような分類学またはオントロジーが利用可能である場合、使用者(およびその他の者)が他のデータセットと組み合わせてデータを使用することができます。 例えば、 一般的な `オス` および `メス` の用語は動物の性行為を意味する(大文字を含まない)。 そして略語を使わずに)多くのオントロジーがこの用語を使っています。 さらに、分析に統合する前に、スプレッドシートを検証するためにいくつかの追加ツールを使用することもできます。

また、欠落しているデータ ポイントについて明確なルールを持っている必要があります。 `NA`, `NULL`を使用する または空のセルは単純ではなく、異なる意味を持つ可能性があります(データポイント、記録されていない、またはデータポイントを失う)。 ある研究者が虹彩の花に花粉媒介者の土地を見る前に費やされた時間を記録したいとしましょう 10分間の実験で受粉媒介者は見られませんでした 研究者が `600` (実験期間は秒単位)を報告するとします。 その場合、受粉者が見られなかったシナリオを区別する方法はありません。 そして、実験の最後に受粉媒介者が見えたとき(そしてその規則を忘れて `600` を正常な値として扱うかもしれません)。

`NA` が報告された場合、この値を存在しないデータポイントと解釈することができる(実験は行われていなかった)。 優雅な解決策は、実験中に受粉媒介者が見られたかどうかを示す第二の列を持つことです。 `TRUE`、 `FALSE` および `NA` の値が受け付けられます。

最後に、スプレッドシートプログラムのデフォルトの動作を認識してください。 異なるプログラムと同じプログラムの異なるバージョンである可能性があります 例えば、小数は通常、フランス語版またはドイツ語版のExcelでカンマで示されます。 英語版では、コンマに意味がないためドットが使用されます (`9, 00 <code>` は `9000` または `9` に翻訳されます。使用しているバージョンによって異なります)。

(rr-rdm-spreadsheets-manipation)=
## 4. データ操作と解析

***表計算ソフトでデータを操作したり分析したりしないでください。***

特に、プロセスが非常にまれに使用されている場合にのみ、別のスプレッドシートから別のスプレッドシートにコピー&ペースト。 さまざまなスプレッドシートを解析ソフトウェアで読み取り、結合することは今や容易ではありません。 ヘッダーが合わない場合、ソフトウェアがエラーメッセージを返すという追加の利点があります。

(rr-rdm-spreadsheets-tips)=
## その他のヒント

(rr-rdm-spreadsheets-tips-time)=
### 時間情報に対処する

日付は `yyyy-mm-dd`として書く必要があります Excel などのソフトウェアは、このデータを独自の日付フォーマットに変換する傾向があります(CSV ファイルからデータをインポートする場合でも)。 これに対処する唯一の100%の安全な方法は、長年にわたって異なる列を作ることです。 何ヶ月何日もかけて解析に使うソフトウェアのデータを再現します 通常、 `hh:mm:ss` で入力された時間は動作します。

(rr-rdm-spreadsheets-tips-several)=
### 複数のシートで作業する

私たちはしばしば異なるが関連するデータに複数のシートを使用します。 これは確かに便利なツールであり、特に完全なデータセットを同僚と共有したい場合に便利です。  
一方、CSVファイルは一度に1枚のみ保存されます。 Though most data analysis software have several ways to import `xlsx` files, the practical solution is to work with the `xlsx` format while making sure that the information is available in CSV format for each sheet. 特に長期保存のために、より良い解決策は、すべてのシートをCSVファイルに別々に保存し、それらをまとめてzipすることです。 このソリューションでは、別のフォーマットである可能性のある追加のドキュメントを含めることもできます (例えば、 ヘッダと選択された単位の意味を説明するテキストファイル)。

(rr-rdm-spreadsheets-tips-design)=
### スプレッドシートデザイン

データは紙の上で手動で収集されることが多い。 最も効率的で間違いを避けるためには、デジタル化されるのと同じ形式でデータを収集するのが最善です。 すなわち、データ収集のために印刷されるコンピュータ読み取り可能なスプレッドシートを設計する必要があります。 これはいくつかの設計上の疑問を提起します。特に、1つの実験に固有の情報(1つのペーパー)についてですが、実験の間で変化する可能性があります(例えば、 実験主義者か部屋の温度) 実際には、その情報を1つの列に入力する必要がありますが、データ取得時(特に論文版)に一度だけ入力する必要があります。 1つの解決策は、これらの列をスプレッドシートの2番目の(印刷されていない)ページに移動し、ヘッダーとフッターを調整して紙のバージョンの情報を入力することです。 情報がデジタル化中に列に入力されていることを確認する必要があります。

情報を入力する方法 (つまり、 ヘッダーとセルの内容を設計する方法は、実行したい分析によって異なる場合があります。 人は、常に可能な限り一般的で客観的であり、人が実行したいと思うかもしれない追加分析について考えるべきです。


一例として 花の長さが6mmを超える花の割合が、3種類の虹彩で異なるとしたら、あなたが描くことに興味があると仮定しましょう。 trueまたはfalseの列 `is-sepal-longer-6cm`を記録する傾向があるかもしれませんが、これによりできる分析が制限されます。 より良い解決策は、セパル(mm単位)の長さを記録し、後で自動的に分類を作成することです。

Rを使用している場合は、次のようにプロットします。
```
iris %>% ## the iris dataset is included in R base
  dplyr::mutate ("is-sepal-longer-than-6cm" = ifelse(Sepal.Length >6, TRUE, FALSE)) %>% ## this create the new column
  ggplot2::ggplot (aes (x=`is-sepal-longer-than-6cm` , fill= Species)) + ggplot2::geom_bar() ## this plots the data
```

ヘッダ名は注意深く選ばれるべきであり、何が意味されているか、どの単位が使用されているかが明確でない場合。 外部ドキュメントに説明を追加することもできます。 また、同僚にサンプルスプレッドシートを共有して、シートがどのように理解できるかについてのフィードバックを受け取ることもできます。

もう一つの方法は、ヘッダの前の最初の行にシートの上にいくつかの説明を追加することです。 人間が読める情報をファイルの一番上に保つことで、ヘッダ行から始まるデータをよりよく理解することができます。 この情報は、データの分析にも役立ち、スクリプトが説明行を無視し、分析中にのみ検討することができます。 ただし、整頓された列と行を持つ良いファイルには、追加の説明は必要ありません。

ヘッダ名については、ヘッダのサイズはコンピュータの問題ではありません。 しかし、人間の読みやすさについては、短く(32文字まで)保つことをお勧めします。

分析のための列の順序について考える必要はありません, それはデータ分析ソフトウェアにとって重要ではないため、. したがって、データ収集ステップのパラメータを完全に最適化することができます。

(rr-rdm-spreadsheets-tips-versioning)=
### 標準とバージョン管理

優れたスプレッドシート設計には、有益で直感的なヘッダー名があり、データ収集と分析の両方を容易にします。 このようなスプレッドシートの設計は、時間、複数回の繰り返し、合意が必要なため、困難です。 したがって、独自のデザインを作成する前に、標準的なスプレッドシートを探して、それが作成された後にあなたのデザインを公然と共有することが有益です。 また、スプレッドシートのバージョン履歴(進化するのと同じように)を使用する必要があります。 解析スクリプトにはバージョン番号が書かれています 表計算ドキュメント、バージョン履歴、それにリンクされているオントロジーのドキュメントは、将来のユーザーに役立ちます。

(rr-rdm-spreadsheets-tips-team)=
### チームでの作業: まとめ

チームでデータ収集を行っている場合は、以下を確認してください。
- 誰もがデータを入力するために同じソフトウェア(およびソフトウェアバージョン)を使用します。
- 誰もがスプレッドシートテンプレートの同じバージョンを使用します。
- 各列が何を表すか、そして使用すべき単位を誰もが理解します。
- 各列には、データを入力する方法や、利用できる用語の分類法に関する定義された標準があります。
- データ収集中に推定的な質問に答えるのは、一人の人が責任を負う。
- 分析ワークフローを入力する前に、できるだけ早く、すべてのスプレッドシートが検証されます。


(rr-rdm-spreadsheets-summary)=
## Summary

スプレッドシートは、データを収集して共有するための非常にユーザーフレンドリーな方法である場合がありますが、誤用された場合、それらはまた間違いの原因となる可能性があります。 解析のための再現可能なワークフローの開発を目指す場合、コンピュータと人間の可読性の両方のためのスプレッドシートを設計する必要があります。 データ収集を始める前に何がデータ分析を容易にするか検討すべきです 特にスプレッドシートでのデータ操作と分析は、再現性のないワークフローにつながるため、避けるのが最善です。 バージョン管理を使用し、データを読み取り専用にすることは、事故を防ぐことができる2つの追加のデータ管理方法です。

README [{term}`def<README>`] ファイルおよびその他の構造の選択肢を使用して命名規則を説明します。 ファイル名とヘッダー名が何を意味するのか、解析ワークフローを設計する際に考慮すべき基準を他の人に明確にします。 あなたがチームで働くならば、あなたは規則に特化し、誰もがそれらに従うことを確認する必要があります。

表計算ドキュメント内のデータ組織の詳細を確認する [社会科学者](https://datacarpentry.org/spreadsheets-socialsci/) と [生態学者](https://datacarpentry.org/spreadsheet-ecology-lesson/)のデータカープエントリーレッスンをご覧ください。
